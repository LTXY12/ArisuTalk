# SNS 4단계 권한 시스템 구현 가이드

## 📋 프로젝트 개요

### 구현 완료된 기능
- **SNS 명칭 변경**: "캐릭터 SNS 목록" → "아리수타그램 목록"
- **본계정/뒷계정 시스템**: 듀얼 계정 시스템과 붉은 테마
- **4단계 권한 시스템**: 점진적 콘텐츠 접근 제어
- **최면 옵션**: 강제 권한으로 모든 콘텐츠 완전 개방

## 🔄 백업 및 복원 가이드

### 현재 백업 상태
- ✅ 모든 변경사항이 `sns_4tier_permission_system.patch` 파일에 저장됨
- ✅ 파일 크기: 101KB (상당한 양의 변경사항 포함)
- ✅ 백업 일시: 2025-08-24

### PR 머지 후 복원 절차

#### 1. 메인 브랜치 최신 상태로 업데이트
```bash
git checkout main
git pull origin main
```

#### 2. 새 기능 브랜치 생성
```bash
git checkout -b feature/sns-4tier-permission-system
```

#### 3. 백업된 변경사항 적용
```bash
git apply sns_4tier_permission_system.patch
```

#### 4. 충돌 해결 및 커밋
```bash
# 충돌이 있다면 수동으로 해결 후:
git add .
git commit -m "feat: Implement SNS 4-tier permission system with hypnosis options

- Add 4-tier access control for SNS content
- Implement main/secret account switching with red theme
- Add hypnosis options for force access permissions
- Create progressive content unlocking based on affection levels"
```

#### 5. 새 PR 생성을 위해 푸시
```bash
git push origin feature/sns-4tier-permission-system
```

## 📝 구현된 기능 상세

### 1. SNS 4단계 권한 시스템

#### 접근 권한 단계
1. **본계정 일반**: 언제든 접근 가능
2. **본계정 비공개**: 호감도 중 하나라도 70% 이상
3. **뒷계정 일반**: 사랑 단계 도달 (모든 호감도 최대치)
4. **뒷계정 비공개**: 사랑 단계 + 특별한 조건 만족

#### 권한 체크 로직
```javascript
// 4단계 접근 권한 체크 (최면 옵션으로 완전 개방 가능)
const hypnosisSNSAccess = hypnosis.enabled && hypnosis.sns_full_access;
const hypnosisSecretAccess = hypnosis.enabled && hypnosis.secret_account_access;

// 본계정 비공개: 호감도 중 하나라도 70% 이상 OR 최면 SNS 전체 접근
const canAccessMainAccountPrivate = hypnosisSNSAccess || 
    affection >= 0.7 || intimacy >= 0.7 || trust >= 0.7 || romantic_interest >= 0.7;

// 뒷계정 일반: 사랑 단계 도달 OR 최면 뒷계정 접근 (완전 개방)
const canAccessSecretAccount = hypnosisSecretAccess || is_love_unlocked || 
    (affection >= 1.0 && intimacy >= 1.0 && trust >= 1.0 && romantic_interest >= 1.0);

// 뒷계정 비공개: 최면 뒷계정 접근 시 완전 개방, 아니면 사랑 단계 + 특별 조건
const canAccessSecretAccountPrivate = hypnosisSecretAccess || 
    (canAccessSecretAccount && secret_content_access);
```

### 2. 최면 옵션 시스템

#### 추가된 최면 옵션
```javascript
hypnosis: {
    enabled: false,
    affection: null,
    intimacy: null,
    trust: null,
    romantic_interest: null,
    force_love_unlock: false,
    sns_full_access: false,        // 📱 SNS 전체 접근 권한
    secret_account_access: false   // 🔥 뒷계정 접근 권한
}
```

#### UI 컴포넌트
- **📱 SNS 전체 접근 권한**: 본계정 비공개 게시물 즉시 접근
- **🔥 뒷계정 접근 권한**: 뒷계정 모든 콘텐츠 즉시 접근

### 3. 듀얼 계정 시스템

#### 본계정 모드
- 기본 회색 테마
- 일반/비공개 탭 구분
- 호감도 기반 점진적 접근

#### 뒷계정 모드
- 붉은 테마 (`bg-red-900/95`, `border-red-800`)
- 애로틱한 시크릿 콘텐츠
- 🔒 아이콘과 "_secret" 접미사
- 사랑 단계 또는 최면 권한 필요

#### 계정 전환 버튼
```javascript
// SNS 계정 전환 버튼 (본계정 <-> 뒷계정)
if (e.target.closest('#sns-account-switch-btn')) {
    const currentMode = app.state.snsSecretMode || false;
    app.setState({ snsSecretMode: !currentMode });
    app.renderSNSFeed();
}
```

### 4. 콘텐츠 생성 함수

#### 게시물 생성 함수들
- `generateSamplePosts()`: 본계정 일반 게시물
- `generatePrivatePosts()`: 본계정 비공개 게시물
- `generateEroticIntimatePrivatePosts()`: 뒷계정 일반 게시물
- `generateEroticSecretPosts()`: 뒷계정 비공개 게시물

#### 잠금 화면 함수들
- `renderMainAccountPrivateLocked()`: 본계정 비공개 잠금
- `renderSecretAccountLocked()`: 뒷계정 잠금
- `renderSecretAccountPrivateLocked()`: 뒷계정 비공개 잠금

## 🎨 UI/UX 개선 사항

### 1. 명칭 변경
- "캐릭터 SNS 목록" → "아리수타그램 목록"
- 단톡방: `${groupChat.name} 참여자 아리수타그램`

### 2. 테마 시스템
- **본계정**: 회색 계열 테마
- **뒷계정**: 붉은 계열 테마 (`bg-red-900/95`, `text-red-300`)

### 3. 권한별 UI 구분
- **최면 권한**: ⚡ 번개 아이콘 + "최면 권한으로 개방된..." 메시지
- **자연 진행**: 👥 기존 아이콘 + "특별한 관계의..." 메시지

### 4. 진행률 표시
- 4개 호감도 수치별 진행률 바
- 색상별 구분 (파랑, 핑크, 초록, 보라)
- 70% 목표치 표시

## 📁 수정된 파일 목록

### 신규 파일
- `src/components/SNSCharacterList.js`
- `src/components/SNSFeed.js`
- `src/handlers/snsHandlers.js`

### 수정된 파일
- `src/api/gemini.js`: characterState 매개변수 추가
- `src/components/CharacterModal.js`: 최면 옵션에 SNS 권한 추가
- `src/handlers/groupChatHandlers.js`: 함수명 수정
- `src/index.js`: 캐릭터 상태 관리 개선

## ⚠️ 주의사항

### 충돌 가능성
- 메인 브랜치 변경사항과 충돌 가능
- 특히 `CharacterModal.js`, `index.js` 파일에서 충돌 예상

### 해결 방법
1. `git apply`로 패치 적용 시도
2. 충돌 발생 시 수동으로 병합
3. 기능 테스트 후 커밋

### 테스트 체크리스트
- [ ] SNS 버튼 클릭 시 아리수타그램 목록 표시
- [ ] 본계정/뒷계정 전환 버튼 작동
- [ ] 호감도별 콘텐츠 접근 제한
- [ ] 최면 옵션으로 강제 접근 가능
- [ ] 뒷계정 붉은 테마 적용

## 🚀 다음 단계

1. 기존 PR 머지 완료 대기
2. 메인 브랜치 최신 상태로 업데이트
3. 패치 파일 적용 및 충돌 해결
4. 기능 테스트 및 검증
5. 새로운 PR 생성 및 제출

---

**백업 파일**: `sns_4tier_permission_system.patch` (101KB)  
**생성 일시**: 2025-08-24  
**구현자**: Claude Code Assistant